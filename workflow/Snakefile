rule download_genome:
	output: 
		idx = "resources/tx_indices/Mus_musculus.GRCm38.cdna.all.release-94_k31.idx"
	conda: 
		"envs/process_dcm_mouse_bulkRNA.yml"
	params:
		url = "https://github.com/pachterlab/kallisto-transcriptome-indices/releases/download/94/Mus_musculus.GRCm38.cdna.all.release-94_k31.idx.gz"
	shell:
		"wget -O {output.idx}.gz {params.url}; gunzip {output.idx}.gz"

# rule gzip_index:
# 	input: 
# 		"resources/tx_indices/Mus_musculus.GRCm38.cdna.all.release-94_k31.idx.gz"
#	output:
#		"resources/tx_indices/Mus_musculus.GRCm38.cdna.all.release-94_k31.idx"
#	conda: 
#		"envs/process_dcm_mouse_bulkRNA.yml"
#	shell:
#		"gzip -d {input} > {output}"

rule run_kallisto:
	input: 
		index = "resources/tx_indices/Mus_musculus.GRCm38.cdna.all.release-94_k31.idx",
		file1 = "/g/steinmetz/incoming/solexa/2021-10-15-HWFVFBGXJ/HWFVFBGXJ_197_21s003517-1-1_Clauder-Muenster_lane121s003517_1_sequence.txt.gz",
		file2 = "/g/steinmetz/incoming/solexa/2021-10-15-HWFVFBGXJ/HWFVFBGXJ_197_21s003517-1-1_Clauder-Muenster_lane121s003517_2_sequence.txt.gz"
	output:
		"results/P635L_mice/output_21s003517-1-1_mice/"
	conda: 
		"envs/process_dcm_mouse_bulkRNA.yml"
	shell:
		"kallisto quant -i {input.index} -o {output} {input.file1} {input.file2}"
